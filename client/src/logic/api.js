import { apiUtilities } from "./apiUtilities";

const test = false

export const api = {

    getTestProducts: (setProductObject) => {
        const testProducts = {"products":[{"id":"prod_O2rU3SMGclmsdd","object":"product","active":true,"attributes":[],"created":1686241970,"default_price":"price_1NGllWC48L00qx1Qkn7VKEsC","description":"1x heel piece, 1x toe piece","images":[],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_-3","weight_oz":"3.5"},"name":"Shim set (-3 deg)","package_dimensions":null,"shippable":true,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686241970,"url":null},{"id":"prod_O2rATrbsu93D0B","object":"product","active":true,"attributes":[],"created":1686240758,"default_price":"price_1NGlRyC48L00qx1QxCpYTasb","description":"1x heel piece, 1x toe piece","images":[],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_-2.5","weight_oz":"3.5"},"name":"Shim set (-2.5 deg)","package_dimensions":null,"shippable":true,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686240758,"url":null},{"id":"prod_O2rA2296X2984F","object":"product","active":true,"attributes":[],"created":1686240744,"default_price":"price_1NGlRkC48L00qx1Q67xeYxnH","description":"1x heel piece, 1x toe piece","images":[],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_-2","weight_oz":"3.5"},"name":"Shim set (-2 deg)","package_dimensions":null,"shippable":true,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686240744,"url":null},{"id":"prod_O2r8rL5921t3Cx","object":"product","active":true,"attributes":[],"created":1686240677,"default_price":"price_1NGlQfC48L00qx1QZkpI94kY","description":"1x heel piece, 1x toe piece","images":[],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_-1.5","weight_oz":"3.5"},"name":"Shim set (-1.5 deg)","package_dimensions":null,"shippable":true,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686240677,"url":null},{"id":"prod_O2r6btOi2KO2E4","object":"product","active":true,"attributes":[],"created":1686240513,"default_price":"price_1NGlO1C48L00qx1Qn85ivZ3z","description":"1x heel piece, 1x toe piece","images":[],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_-1","weight_oz":"3.5"},"name":"Shim set (-1 deg)","package_dimensions":null,"shippable":true,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686240513,"url":null},{"id":"prod_O19HuTkJriSm38","object":"product","active":true,"attributes":[],"created":1685846857,"default_price":"price_1NF6yjC48L00qx1QvLXw2czk","description":"1x heel piece, 1x toe piece ","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfam1hbFNCSTdMWlMxU2NMWHpSQjMyUGVp00ZNGQV5nt"],"livemode":true,"metadata":{"category":"Under-sole canting","description":"\n1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_-0.5","weight_oz":"3.5"},"name":"Shim set (-0.5 deg)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686233282,"url":null},{"id":"prod_O1953PsZZlUfFX","object":"product","active":true,"attributes":[],"created":1685846126,"default_price":"price_1NF6mxC48L00qx1QyxGqWqyg","description":"2x heel piece, 2x toe piece. Screws included.","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfUEI2R0E3N2FodEUzYXFIN2g3RXpQbGNa00B6s8HGmu"],"livemode":true,"metadata":{"category":"Under-sole canting","name_variant":"Lifter set_Thickness_5mm","weight_oz":"3.5"},"name":"Lifter set (5mm)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1685846127,"url":null},{"id":"prod_O0zICNsGcU5qYv","object":"product","active":true,"attributes":[],"created":1685809705,"default_price":"price_1NExJWC48L00qx1QhX4EqNWf","description":"2x heel piece, 2x toe piece. Screws included.","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfT25JWFV2dDY2dXZLYjY2dW1DZHY0YkV500xMnC4lFI"],"livemode":true,"metadata":{"category":"Under-sole canting","name_variant":"Lifter set_Thickness_3mm","weight_oz":"3.5"},"name":"Lifter set (3mm)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1685809732,"url":null},{"id":"prod_O0zFqVCJLoMM2v","object":"product","active":true,"attributes":[],"created":1685809537,"default_price":"price_1NExGnC48L00qx1QtYmsqfPt","description":"2x heel piece, 2x toe piece. Screws included.","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfR0xzRGtUODUyT1MzMmNyUUQ0MUNEUDNJ00lyUwHRDx"],"livemode":true,"metadata":{"category":"Under-sole canting","name_variant":"Lifter set_Thickness_2mm","weight_oz":"3.5"},"name":"Lifter set (2mm)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1685809538,"url":null},{"id":"prod_O0xaPcXo5t4t7W","object":"product","active":true,"attributes":[],"created":1685803392,"default_price":"price_1NEvfhC48L00qx1QxOiHsPSW","description":"1× heel piece, 1x toe piece","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfQTZuTHVaWkZOOVpTbDB0YjJFWlBsNEpB00FwEbYJSB"],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_3","weight_oz":"3.5"},"name":"Shim set (3 deg)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686234094,"url":null},{"id":"prod_O0xYOjOzeUiwp8","object":"product","active":true,"attributes":[],"created":1685803277,"default_price":"price_1NEvdpC48L00qx1QklZyvIaY","description":"1× heel piece, 1x toe piece","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfMHo2UDF6MmlJaDdNS3AxZmdzWWY0SnV400tvFBstEy"],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_2.5","weight_oz":"3.5"},"name":"Shim set (2.5 deg)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686234166,"url":null},{"id":"prod_O0xWXqYfQKsLXh","object":"product","active":true,"attributes":[],"created":1685803150,"default_price":"price_1NEvbmC48L00qx1QsR4MFfON","description":"1× heel piece, 1x toe piece","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfY0p4WndKV2JRc0dVVDY5Z1VUUnpGNTll00L3Sd9lef"],"livemode":true,"metadata":{"category":"Under-sole canting","description":". All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_2","weight_oz":"3.5"},"name":"Shim set (2 deg)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686234216,"url":null},{"id":"prod_O0xVR5FOj8A50D","object":"product","active":true,"attributes":[],"created":1685803041,"default_price":"price_1NEva2C48L00qx1QG6iVcXym","description":"1× heel piece, 1x toe piece","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfZEFqZW1CMmVGT1V1cmdQUDdDSGpqUHhK00z9h8tR5Y"],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_1.5","weight_oz":"3.5"},"name":"Shim set (1.5 deg)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686234258,"url":null},{"id":"prod_O0xSOf8Qi1wJKm","object":"product","active":true,"attributes":[],"created":1685802875,"default_price":"price_1NEvXLC48L00qx1QUcnQnoc7","description":"1× heel piece, 1x toe piece","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfSWJWaHlDb3ZUMFdrOHlTbFlmSGxTQUhr00Oo8SHk4T"],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_1","weight_oz":"3.5"},"name":"Shim set (1 deg)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686234295,"url":null},{"id":"prod_O0xPU0ETB491AL","object":"product","active":true,"attributes":[],"created":1685802696,"default_price":"price_1NEvUTC48L00qx1QayIGTLvW","description":"1× heel piece, 1x toe piece","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfY0ZRUWFieVByYXcySFBIbERDNjZvd2R600CuOgAjeY"],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_0.5","weight_oz":"3.5"},"name":"Shim set (0.5 deg)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686234317,"url":null},{"id":"prod_O0CEjO95V88FTu","object":"product","active":true,"attributes":[],"created":1685627229,"default_price":"price_1NEBqLC48L00qx1Ql7YoLZE3","description":"1× heel piece, 1x toe piece","images":["https://files.stripe.com/links/MDB8YWNjdF8xTjhvMGZDNDhMMDBxeDFRfGZsX2xpdmVfd0RRRW90bm5sYU9CZ203VmpLREdqV2tr0025XKpmNX"],"livemode":true,"metadata":{"category":"Under-sole canting","description":"1× heel piece, 1x toe piece. All shims are stack height normalized to 2.3mm at centre-line. Use 0 degree shim where no canting is required. Angle values are relative to right boot. E.g. to cant right & left boot OUT by 1 degree select 1 and -1","name_variant":"Shim set_Angle_0","weight_oz":"3.5"},"name":"Shim set (0 deg)","package_dimensions":null,"shippable":null,"statement_descriptor":null,"tax_code":null,"type":"service","unit_label":null,"updated":1686234347,"url":null}],"prices":[{"id":"price_1NGllWC48L00qx1Qkn7VKEsC","object":"price","active":true,"billing_scheme":"per_unit","created":1686241970,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O2rU3SMGclmsdd","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NGlRyC48L00qx1QxCpYTasb","object":"price","active":true,"billing_scheme":"per_unit","created":1686240758,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O2rATrbsu93D0B","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NGlRkC48L00qx1Q67xeYxnH","object":"price","active":true,"billing_scheme":"per_unit","created":1686240744,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O2rA2296X2984F","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NGlQfC48L00qx1QZkpI94kY","object":"price","active":true,"billing_scheme":"per_unit","created":1686240677,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O2r8rL5921t3Cx","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NGlO1C48L00qx1Qn85ivZ3z","object":"price","active":true,"billing_scheme":"per_unit","created":1686240513,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O2r6btOi2KO2E4","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NF6yjC48L00qx1QvLXw2czk","object":"price","active":true,"billing_scheme":"per_unit","created":1685846857,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O19HuTkJriSm38","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NF6mxC48L00qx1QyxGqWqyg","object":"price","active":true,"billing_scheme":"per_unit","created":1685846127,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O1953PsZZlUfFX","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":3000,"unit_amount_decimal":"3000"},{"id":"price_1NExJWC48L00qx1QhX4EqNWf","object":"price","active":true,"billing_scheme":"per_unit","created":1685809706,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O0zICNsGcU5qYv","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":3000,"unit_amount_decimal":"3000"},{"id":"price_1NExGnC48L00qx1QtYmsqfPt","object":"price","active":true,"billing_scheme":"per_unit","created":1685809537,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O0zFqVCJLoMM2v","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":3000,"unit_amount_decimal":"3000"},{"id":"price_1NEvfhC48L00qx1QxOiHsPSW","object":"price","active":true,"billing_scheme":"per_unit","created":1685803393,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O0xaPcXo5t4t7W","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NEvdpC48L00qx1QklZyvIaY","object":"price","active":true,"billing_scheme":"per_unit","created":1685803277,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O0xYOjOzeUiwp8","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NEvbmC48L00qx1QsR4MFfON","object":"price","active":true,"billing_scheme":"per_unit","created":1685803150,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O0xWXqYfQKsLXh","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NEva2C48L00qx1QG6iVcXym","object":"price","active":true,"billing_scheme":"per_unit","created":1685803042,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O0xVR5FOj8A50D","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NEvXLC48L00qx1QUcnQnoc7","object":"price","active":true,"billing_scheme":"per_unit","created":1685802875,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O0xSOf8Qi1wJKm","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NEvUTC48L00qx1QayIGTLvW","object":"price","active":true,"billing_scheme":"per_unit","created":1685802697,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O0xPU0ETB491AL","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"},{"id":"price_1NEBqLC48L00qx1Ql7YoLZE3","object":"price","active":true,"billing_scheme":"per_unit","created":1685627229,"currency":"cad","custom_unit_amount":null,"livemode":true,"lookup_key":null,"metadata":{},"nickname":null,"product":"prod_O0CEjO95V88FTu","recurring":null,"tax_behavior":"unspecified","tiers_mode":null,"transform_quantity":null,"type":"one_time","unit_amount":2000,"unit_amount_decimal":"2000"}]}
        setProductObject(apiUtilities.mergeProductsAndPrices(testProducts.prices, testProducts.products));
    },

    getProducts: async (setProductObject, setError) => {
        if (test) return api.getTestProducts(setProductObject);
        try {
            const data = await fetch('/get-products');
            const dataJson = await data.json();
            if (dataJson.error) throw new Error(dataJson.error);
            const prices = dataJson.prices;
            const products = dataJson.products;
            setProductObject(apiUtilities.mergeProductsAndPrices(prices, products));
        }
        catch (err) {
            console.log(err.message)
            setError({ open: true, message: err.message });
        }
    },

    getTestShippingRate: async (setShippingData, address, setLoading, setSuccess) => {
        const shippingData = {
            shipping: {
                name: 'Shipping',
                price: 'shipping',
                info: 'test',
                unit_amount: 1445,
                quantity: 1,
                address: address
            },
            isShipping: true
        }
        setShippingData(shippingData);
        setLoading(false);
        setSuccess(true);
    },

    getShippingRate: async (setShippingData, address, cartData, setError, setLoading, setSuccess) => {
        if (test) return api.getTestShippingRate(setShippingData, address, setLoading, setSuccess);
        const shippingRateObject = {
            address: address,
            items: cartData
        }

        try {
            const data = await fetch('/get-shipping-rate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(shippingRateObject)
            });
            const dataJson = await data.json();
            if (dataJson.error) throw new Error(dataJson.error);
            setShippingData(dataJson);
            setLoading(false);
            setSuccess(true);
        }
        catch (err) {
            console.log(err.message)
            setLoading(false);
            setError({ open: true, message: err.message });
        }
    },

}





